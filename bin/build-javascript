#!/usr/local/bin/php
<?php

$icons = [];
foreach (scandir('./svg') as $file) {
	if (in_array($file, ['.', '..']))
		continue;

	$id = str_replace('.svg', '', $file);
	$svg = file_get_contents("./svg/$file");

	$doc = new DOMDocument();
	$ok = @$doc->loadHTML($svg);

	if (!$ok) {
		echo "❌ Failed to download or parse icon $file\n";
		return 1;
	}

	$node = $doc->getElementsByTagName('svg')->item(0);
	$path = $node->getElementsByTagName('path')->item(0)->getAttribute('d');

	$w = $node->getAttribute('width');
	$h = $node->getAttribute('height');

	$w = (int)str_replace('px', '', $w);
	$h = (int)str_replace('px', '', $h);

	$icons[$id] = [0, 0, $w, $h, $path];
}

$json = json_encode($icons, JSON_PRETTY_PRINT);
$json = preg_replace('/\[\s+(\d+),\s+(\d+),\s+(\d+),\s+(\d+),\s+(".+")\s+\]/', '[\1, \2, \3, \4, \5]', $json);
$count = count($icons);

$js = "var icons = $json\n\n" . file_get_contents('./suffix.js');
$jspath = './dist/ha-feller-icons.js';

if (is_file($jspath))
	unlink($jspath);

file_put_contents($jspath, $js);

echo "✅ Sucessfully updated javascript file with $count icons\n";

return 0;
